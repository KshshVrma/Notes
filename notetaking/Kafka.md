There is a large amount of “log” data generated at any sizable internet company. This data typically includes (1) user activity events corresponding to logins, pageviews, clicks, “likes”, sharing, comments, and search queries;

This production, real-time usage of log data creates new challenges for data systems because its volume is orders of magnitude larger than the “real” data

we developed a new messaging-based log aggregator Kafka. We first introduce the basic concepts in Kafka. A stream of messages of a particular type is defined by a topic. A producer can publish messages to a topic. The published messages are then stored at a set of servers called brokers. A consumer can subscribe to one or more topics from the brokers, and consume the subscribed messages by pulling data from the brokers.

. We support both the point-topoint delivery model in which multiple consumers jointly consume a single copy of all messages in a topic, as well as the publish/subscribe model in which multiple consumers each retrieve its own copy of a topic.

 Kafka Architecture

<img src="data:image/png;base64,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" width=430px/>






Storage
Every time a producer publishes a message to a partition, the broker simply appends the message to the last segment file. For better performance, we flush the segment files to disk only after a configurable number of messages have been published or a certain amount of time has elapsed. A message is only exposed to the consumers after it is flushed.

Stateless broker:
Unlike most other messaging systems, in Kafka, the information about how much each consumer has consumed is not maintained by the broker, but by the consumer itself. Such a design reduces a lot of the complexity and the overhead on the broker. However, this makes it tricky to delete a message, since a broker doesn’t know whether all subscribers have consumed the message. Kafka solves this problem by using a simple time-based SLA for the retention policy. A message is automatically deleted if it has been retained in the broker longer than a certain period, typically 7 days. This solution works well in practice. Most consumers, including the offline ones, finish consuming either daily, hourly, or in real-time. The fact that the performance of Kafka doesn’t degrade with a larger data size makes this long retention feasible

We note that rewinding a consumer is much easier to support in the pull model than the push model.

Our first decision is to make a partition within a topic the smallest unit of parallelism. This means that at any given time, all messages from one partition are consumed only by a single consumer within each consumer group.

Had we allowed multiple consumers to simultaneously consume a single partition, they would have to coordinate who consumes what messages

The second decision that we made is to not have a central “master” node, but instead let consumers coordinate among themselves in a decentralized fashion.

To facilitate the coordination, we employ a highly available consensus service Zookeeper

Specifically, when each broker or consumer starts up, it stores its information in a broker or consumer registry in Zookeeper. The broker registry contains the broker’s host name and port, and the set of topics and partitions stored on it. The consumer registry includes the consumer group to which a consumer belongs and the set of topics that it subscribes to

The offset registry stores for each subscribed partition, the offset of the last consumed message in the partition.

Each consumer registers a Zookeeper watcher on both the broker registry and the consumer registry, and will be notified whenever a change in the broker set or the consumer group occurs.

By reading the broker and the consumer registry from Zookeeper, the consumer first computes the set (PT) of partitions available for each subscribed topic T and the set (CT) of consumers subscribing to T. It then range-partitions PT into |CT| chunks and deterministically picks one chunk to own. For each partition the consumer picks, it writes itself as the new owner of the partition in the ownership registry. Finally, the consumer begins a thread to pull data from each owned partition, starting from the offset stored in the offset registry. As messages get pulled from a partition, the consumer periodically updates the latest consumed offset in the offset registry

Kafka guarantees that messages from a single partition are delivered to a consumer in order. However, there is no guarantee on the ordering of messages coming from different partitions.